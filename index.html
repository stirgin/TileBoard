<!doctype html>
<html lang="en" ng-app="App">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

   <title>TileBoard</title>

   <meta name="mobile-web-app-capable" content="yes">
   <!-- iOS Settings -->
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

   <link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64" href="favicon.png">
   <link rel="stylesheet" async href="./styles/plugins/materialdesignicons.min.css">
   <link rel="stylesheet" async href="./styles/styles.css"/>

   <script>
       var DOMAIN_PATH = '/local/tileboard/dist';
   </script>
   <script defer src="./boot.min.js"></script>

   <script defer src="./configs/config.js"></script>
   <script defer src="./configs/cameras.js"></script>

   <script defer src="./bootpatch.min.js"></script>
</head>

<body ng-controller="MainController" ng-class="getBodyClass()">

<main ng-view></main>

<!-- HEAD TEMPLATE -->
<script type="text/ng-template" id="head.html">
   <div class="page-head-content">
      <div class="page-head--left">
         <div class="page-head--time" ng-style="clockStyles()">
            <clock></clock>
         </div>
      </div>
      <div class="page-head--right">
      </div>
   </div>
</script>

<script type="text/ng-template" id="header.html">
   <div class="header-content" ng-style="header.styles">
      <div class="header--left">
         <div header-item ng-repeat="item in header.left track by $index"></div>
      </div>
      <div class="header--right">
         <div header-item ng-repeat="item in header.right track by $index"></div>
      </div>
   </div>
</script>


<!-- HEADER ITEMS TEMPLATE -->

<script type="text/ng-template" id="header-items.html">
   <div class="header-item" ng-class="'-' + item.type" ng-style="item.styles">
      <div ng-if="item.type === HEADER_ITEMS.TIME">
         <clock></clock>
      </div>
      <div ng-if="item.type === HEADER_ITEMS.DATE">
         <date format="item.format"></date>
      </div>
      <div ng-if="item.type === HEADER_ITEMS.DATETIME">
         <clock></clock>
         <date format="item.dateFormat"></date>
      </div>
      <div ng-if="item.type === HEADER_ITEMS.CUSTOM_HTML">
         <div ng-bind-html="item.html"></div>
      </div>
      <div ng-if="item.type === HEADER_ITEMS.WEATHER">
         <div class="header-weather--icon-container">
            <div class="header-weather--icon"
                 ng-if="(_icon = getWeatherIcon(item, {}))">
               <div class="wu " ng-class="'wu-' + _icon"></div>
            </div>
            <div class="header-weather--icon-image"
                 ng-if="(_imgStyles = getWeatherImageStyles(item, {}))">
               <div ng-style="_imgStyles"></div>
            </div>
         </div>

         <div class="header-weather--temperature" ng-if="item.fields.temperature">
            <span ng-bind="getWeatherField('temperature', item, {})"></span>
            <span ng-bind="getWeatherField('temperatureUnit', item, {})"></span>
         </div>

         <div class="header-weather--summary" ng-if="item.fields.summary">
            <span ng-bind="getWeatherField('summary', item, {})"></span>
         </div>
      </div>
   </div>
</script>



<!-- TILE TEMPLATE -->

<script type="text/ng-template" id="tile.html">
   <div ng-style="itemStyles(page, item, entity)" class="item"
        ng-click="entityClick(page, item, entity)"
        on-long-press="entityLongClick($event, page, item, entity)"
        ng-if="(entity = getItemEntity(item)) && !isHidden(item, entity)"
        ng-class="itemClasses(item)">

      <div class="item-clickable"></div>

      <div ng-if="item.bg || item.bgSuffix" class="item-background"
           ng-style="itemBgStyles(item, entity)"></div>

      <div class="item-title" ng-bind="_title"
           ng-if="(_title = entityTitle(item, entity))"></div>

      <div class="item-subtitle" ng-bind="_subtitle"
           ng-if="(_subtitle = entitySubtitle(item, entity))"></div>

      <div class="item-state" ng-bind="_state"
           ng-if="(_state = entityState(item, entity))"></div>

      <div class="item-slides-container" ng-if="item.slides.length">
         <div class="item-slides" ng-class="'-c' + item.slides.length"
              ng-if="item.slides.length" ng-style="slidesStyles(item, $index)">
            <div class="item-slide" ng-repeat="slide in item.slides track by $index"
                 ng-style="slideStyles(slide, item, entity)"></div>
         </div>
      </div>

      <div ng-if="item.type === TYPES.DEVICE_TRACKER"
           class="item-entity-container -below">

         <div class="item-slides-container" ng-if="hasTrackerCoords(entity)">
            <div class="item-slides" ng-class="trackerSlidesClass(item, entity)"
                 ng-style="slidesStyles(item, $index)">
               <div class="item-slide -bg" ng-style="trackerBg(entity)"
                    ng-if="showTrackerBg(item, entity)"></div>

               <div class="item-slide -map"
                    ng-repeat="zoom in trackerZoomLevels(item, entity) track by $index"
                    ng-style="slideMapStyles(item, page, entity.attributes, zoom, entity.state)"></div>
            </div>
         </div>

         <div ng-if="!hasTrackerCoords(entity) && entity.attributes.entity_picture"
              class="item-background" ng-style="trackerBg(entity)"></div>
      </div>

      <div ng-if="item.type === TYPES.SENSOR"
           class="item-entity-container">
         <div class="item-entity">
            <span ng-bind="entityValue(item, entity)"
                  class="item-entity--value"></span>

            <span ng-if="(_unit = entityUnit(item, entity))"
                  class="item-entity--unit" ng-bind="_unit"></span>
         </div>
      </div>

      <div ng-if="item.type === TYPES.SWITCH"
           class="item-entity-container">

         <div class="item-entity">
            <span class="item-entity--icon mdi"
                  ng-class="entityIcon(item, entity)"></span>
         </div>
      </div>

      <div ng-if="item.type === TYPES.LOCK"
           class="item-entity-container">

         <div class="item-entity">
            <span class="item-entity--icon mdi"
                  ng-class="entityIcon(item, entity)"></span>
         </div>
      </div>

      <div ng-if="item.type === TYPES.COVER"
           class="item-entity-container">

         <div class="item-cover">
            <div class="item-cover--button -open"
                 ng-class="{'-disabled': entity.state === 'open'}"
                 ng-click="sendCover('open_cover', item, entity)">
               <i class="mdi mdi-arrow-up"></i>
            </div>

            <div class="item-cover--button -stop"
                 ng-click="sendCover('stop_cover', item, entity)">
               <i class="mdi mdi-stop"></i>
            </div>

            <div class="item-cover--button -close"
                 ng-class="{'-disabled': entity.state === 'closed'}"
                 ng-click="sendCover('close_cover', item, entity)">
               <i class="mdi mdi-arrow-down"></i>
            </div>
         </div>
      </div>

      <div ng-if="item.type === TYPES.COVER_TOGGLE"
           class="item-entity-container">

         <div class="item-entity">
            <span class="item-entity--icon mdi"
                  ng-class="entityIcon(item, entity)"></span>
         </div>
      </div>

      <div ng-if="item.type === TYPES.FAN"
           class="item-entity-container">

         <div class="item-entity" ng-if="(_icon = entityIcon(item, entity))"
              ng-class="{'-with-select': entity.attributes.speed_list}">
            <span class="item-entity--icon mdi" ng-class="_icon"></span>
         </div>

         <div class="item-fan">
            <div class="item-fan--speed" ng-if="entity.attributes.speed_list"
                 ng-click="openFanSpeedSelect($event, item)">
               <span ng-bind="entity.attributes.speed"></span>
            </div>
         </div>

         <div ng-if="selectOpened(item)" class="item-select"
              ng-style="itemSelectStyles(entity, entity.attributes.speed_list)">

            <div class="item-select--option"
                 ng-repeat="option in entity.attributes.speed_list track by $index"
                 ng-class="{'-active': option === entity.attributes.speed}"
                 ng-click="setFanSpeed($event, item, entity, option)">
               <span ng-bind="option"></span>
            </div>
         </div>
      </div>

      <div ng-if="item.type === TYPES.CUSTOM"
           class="item-entity-container">

         <div ng-if="item.customHtml"
              ng-bind-html="item.customHtml"></div>

         <div ng-if="!item.customHtml" class="item-entity">
            <span class="item-entity--icon mdi"
                  ng-class="entityIcon(item, entity)"></span>
         </div>
      </div>

      <div ng-if="item.type === TYPES.ROUTER"
           class="item-entity-container">

         <a class="router-link" ng-href="#!ROUTER[item.routerType]">
            <div class="item-entity">
                  <span class="item-entity--icon mdi"
                        ng-class="entityIcon(item, entity)"></span>
            </div>
         </a>
      </div>

      <div ng-if="item.type === TYPES.SCRIPT"
           class="item-entity-container">

         <div class="item-entity">
            <span class="item-entity--icon mdi"
                  ng-class="entityIcon(item, entity)"></span>
         </div>
      </div>

      <div ng-if="item.type === TYPES.AUTOMATION"
           class="item-entity-container">

         <div class="item-entity">
            <span class="item-entity--icon mdi"
                  ng-class="entityIcon(item, entity)"></span>
         </div>
      </div>

      <div ng-if="item.type === TYPES.VACUUM"
           class="item-entity-container">

         <div class="item-entity">
            <span class="item-entity--icon mdi"
                  ng-class="entityIcon(item, entity)"></span>
         </div>
      </div>

      <div ng-if="item.type === TYPES.SENSOR_ICON"
           class="item-entity-container">
         <div class="item-entity">
            <span class="item-entity--icon mdi"
                  ng-class="entityIcon(item, entity)"></span>
         </div>
      </div>

      <div ng-if="item.type === TYPES.INPUT_BOOLEAN"
           class="item-entity-container">

         <div class="item-entity">
            <span class="item-entity--icon mdi"
                  ng-class="entityIcon(item, entity)"></span>
         </div>
      </div>

      <div ng-if="item.type === TYPES.LIGHT"
           class="item-entity-container">

         <div ng-if="!item.controlsEnabled">
            <div ng-if="entity.state !== 'off'">
               <div class="item-button -center-right"
                    ng-click="increaseBrightness($event, item, entity)">
                  <i class="mdi mdi-plus"></i>
               </div>
               <div class="item-button -bottom-right"
                    ng-click="decreaseBrightness($event, item, entity)">
                  <i class="mdi mdi-minus"></i>
               </div>
            </div>
            <div class="item-entity">
               <span class="item-entity--icon mdi"
                     ng-class="entityIcon(item, entity)"></span>
            </div>
         </div>
         <div ng-if="item.controlsEnabled" class="item-entity-sliders"
              ng-click="preventClick($event)">
            <div ng-repeat="slider in item.sliders track by $index"
                 ng-if="(_c = getLightSliderConf(slider, entity))"
                 class="item-slider-container">

               <div class="item-slider-title" ng-if="slider.title">
                  <span ng-bind="slider.title"></span>:
                  <span ng-bind="getLightSliderValue(slider, _c)"></span>
               </div>

               <div class="item-slider">
                  <input type="range" ng-model="_c.value" value="{{ _c.value }}"
                         ng-change="lightSliderChanged(slider, item, entity, _c)"
                         step="{{ _c.step }}" min="{{ _c.min }}" max="{{ _c.max }}">
               </div>
            </div>

            <div class="item-entity--back-button"
                 ng-click="closeLightSliders($event, item, entity)">
               <i class="mdi mdi-chevron-left"></i> Back
            </div>
         </div>
      </div>

      <div ng-if="item.type === TYPES.TEXT_LIST"
           class="item-entity-container">
         <div class="item-list">
            <div class="item-list--item"
                 ng-repeat="line in item.list track by $index">
               <div class="item-list--name">
                  <i class="mdi" ng-class="listField('icon', item, line)" ng-if="line.icon"></i>
                  <span ng-bind="listField('title', item, line)"></span>
               </div>
               <div class="item-list--value">
                  <span ng-bind="listField('value', item, line)"></span><!--
               --><span ng-bind="listField('unit', item, line)"></span>
               </div>
            </div>
         </div>
      </div>

      <div ng-if="item.type === TYPES.INPUT_NUMBER"
           class="item-entity-container">
         <div>
            <div class="item-button -center-right"
                 ng-click="increaseNumber($event, item, entity)">
               <i class="mdi mdi-plus"></i>
            </div>
            <div class="item-button -bottom-right"
                 ng-click="decreaseNumber($event, item, entity)">
               <i class="mdi mdi-minus"></i>
            </div>
         </div>

         <div class="item-entity">
            <span ng-bind="entityValue(item, entity)"
                  class="item-entity--value"></span>
            <span ng-if="(_unit = entityUnit(item, entity))"
                  class="item-entity--unit" ng-bind="_unit"></span>
         </div>
      </div>


      <div ng-if="item.type === TYPES.INPUT_SELECT"
           class="item-entity-container">
         <div ng-if="selectOpened(item)" class="item-select"
              ng-style="itemSelectStyles(entity, entity.attributes.options)">
            <div class="item-select--option"
                 ng-repeat="option in entity.attributes.options track by $index"
                 ng-class="{'-active': option === entity.state}"
                 ng-click="setSelectOption($event, item, entity, option)">
               <span ng-bind="option"></span>
            </div>
         </div>
         <div class="item-triangle"></div>
         <div class="item-entity -select">
            <span class="item-entity--value">
               <span ng-bind="entityValue(item, entity)"></span>
            </span>
            <span ng-if="(_unit = entityUnit(item, entity))"
                  class="item-entity--unit" ng-bind="_unit"></span>
         </div>
      </div>

      <div ng-if="item.type === TYPES.INPUT_DATETIME"
           class="item-entity-container">
         <div class="item-entity">
            <span ng-bind="entityValue(item, entity)"
                  class="item-entity--value -datetime"></span>
         </div>
      </div>


      <div ng-if="item.type === TYPES.CAMERA"
           class="item-entity-container -below">
         <div class="item-camera">
            <camera item="item" entity="entity"
                    freezed="!isPageActive(page) || activeCamera"></camera>
         </div>
      </div>


      <div ng-if="item.type === TYPES.CAMERA_THUMBNAIL"
           class="item-entity-container -below">
         <div class="item-camera">
            <camera-thumbnail freezed="!isPageActive(page) || activeCamera"
                              item="item" entity="entity"></camera-thumbnail>
         </div>
      </div>

      <div ng-if="item.type === TYPES.SCENE"
           class="item-entity-container">

         <div class="item-entity">
            <span class="item-entity--icon mdi"
                  ng-class="entityIcon(item, entity)"></span>
         </div>
      </div>

      <div ng-if="item.type === TYPES.SLIDER"
           class="item-entity-container" ng-class="{'-slider-bottom': item.bottom}">

         <div class="item-entity">
            <span ng-bind="entityValue(item, entity)"
                  class="item-entity--value"></span>
            <span ng-if="(_unit = entityUnit(item, entity))"
                  class="item-entity--unit" ng-bind="_unit"></span>
         </div>

         <div class="item-slider" ng-if="(_c = getSliderConf(item, entity))">
            <input type="range" ng-model="_c.value"
                   ng-change="sliderChanged(item, entity, _c)"
                   step="{{ _c.step }}" min="{{ _c.min }}" max="{{ _c.max }}">
         </div>
      </div>

      <div ng-if="item.type === TYPES.IFRAME"
           class="item-entity-container">

         <div class="item-iframe">
            <iframe ng-src="{{ item.url }}" iframe-tile="item" frameborder="0"></iframe>
         </div>
      </div>


      <div ng-if="item.type === TYPES.DOOR_ENTRY"
           class="item-entity-container">

         <div class="item-entity">
            <span class="item-entity--icon mdi"
                  ng-class="entityIcon(item, entity)"></span>
         </div>
      </div>


      <div ng-if="item.type === TYPES.ALARM"
           class="item-entity-container">

         <div class="item-entity">
            <span class="item-entity--icon mdi"
                  ng-class="entityIcon(item, entity)"></span>
         </div>
      </div>


      <div ng-if="item.type === TYPES.WEATHER"
           class="item-entity-container">
         <div class="weather">
            <div class="weather-icon-container">
               <div class="weather-icon"
                    ng-if="(_icon = getWeatherIcon(item, entity))">
                  <div class="wu " ng-class="'wu-' + _icon"></div>
               </div>
               <div class="weather-icon-image"
                    ng-if="(_imgStyles = getWeatherImageStyles(item, entity))">
                  <div ng-style="_imgStyles"></div>
               </div>
            </div>

            <div class="weather-temperature" ng-if="item.fields.temperature">
               <span ng-bind="getWeatherField('temperature', item, entity)"></span>
               <span ng-bind="getWeatherField('temperatureUnit', item, entity)"></span>
            </div>

            <div class="weather-line -items">
               <span ng-if="item.fields.highTemperature" class="weather-item">
                  <i class="mdi mdi-arrow-collapse-up"></i>
                  <span ng-bind="getWeatherField('highTemperature', item, entity)"></span><!--
               --><span ng-bind="getWeatherField('highTemperatureUnit', item, entity)"></span>
               </span>
            </div>

            <div class="weather-line -items">
               <span ng-if="item.fields.lowTemperature" class="weather-item">
                  <i class="mdi mdi-arrow-collapse-down"></i>
                  <span ng-bind="getWeatherField('lowTemperature', item, entity)"></span><!--
               --><span ng-bind="getWeatherField('lowTemperatureUnit', item, entity)"></span>
               </span>
            </div>

            <div class="weather-line -items">
               <span ng-if="item.fields.humidity" class="weather-item">
                  <i class="mdi mdi-water"></i>
                  <span ng-bind="getWeatherField('humidity', item, entity)"></span><!--
               --><span ng-bind="getWeatherField('humidityUnit', item, entity)"></span>
               </span>

               <span ng-if="item.fields.windSpeed" class="weather-item">
                  <i class="mdi mdi-weather-windy"></i>
                  <span ng-bind="getWeatherField('windSpeed', item, entity)"></span><!--
               --><span ng-bind="getWeatherField('windSpeedUnit', item, entity)"></span>
               </span>
            </div>

            <div class="weather-line" ng-repeat="line in item.fields.list">
               <span ng-bind="getWeatherLine(line, item. entity)"></span>
            </div>

            <!-- DEPRECATED -->
            <div class="weather-line" ng-if="item.fields.apparentTemperature">
               Feels like
               <span ng-bind="getWeatherField('apparentTemperature', item, entity)"></span>
               <span ng-bind="getWeatherField('apparentTemperatureUnit', item, entity)"></span>
            </div>

            <div class="weather-line" ng-if="item.fields.pressure">
               Pressure
               <span ng-bind="getWeatherField('pressure', item, entity)"></span>
               <span ng-bind="getWeatherField('pressureUnit', item, entity)"></span>
            </div>

            <div class="weather-line" ng-if="item.fields.pollen">
               Pollen
               <span ng-bind="getWeatherField('pollen', item, entity)"></span>
            </div>

            <div class="weather-line" ng-if="item.fields.precipProbability">
               <span ng-bind="getWeatherField('precipProbability', item, entity)"></span><!--
            --><span ng-bind="getWeatherField('precipProbabilityUnit', item, entity)"></span>
               chance of rain
            </div>
            <!-- ///DEPRECATED -->
         </div>
      </div>

      <div ng-if="item.type === TYPES.WEATHER_LIST"
           class="item-entity-container">
         <div class="weather-list">
            <table>
               <tr class="weather-list-header" ng-hide="item.hideHeader">
                  <th>
                     <span ng-bind="itemField('dateTitle', item, entity) || 'Date'"></span>
                  </th>
                  <th></th>
                  <th>
                     <span ng-bind="itemField('primaryTitle', item, entity) || 'Forecast'"></span>
                  </th>
                  <th class="weather-list-header--secondary">
                     <span ng-bind="itemField('secondaryTitle', item, entity)"></span>
                  </th>
               </tr>
               <tr ng-repeat="line in item.list track by $index">
                  <td class="weather-list-date">
                     <div ng-bind="weatherListField('date', line, item, entity)"></div>
                  </td>
                  <td class="weather-list-icon-container">
                     <div class="weather-list-icon"
                          ng-if="(_icon = weatherListIcon(line, item, entity))">
                        <div class="wu " ng-class="'wu-' + _icon"></div>
                     </div>
                     <div class="weather-list-icon-image"
                          ng-if="(_imgStyles = weatherListImageStyles(line, item, entity))">
                        <div ng-style="_imgStyles"></div>
                     </div>
                  </td>
                  <td class="weather-list--primary">
                     <div ng-bind="weatherListField('primary', line, item, entity)"></div>
                  </td>
                  <td class="weather-list--secondary">
                     <div ng-bind="weatherListField('secondary', line, item, entity)"></div>
                  </td>
               </tr>
            </table>
         </div>
      </div>

      <div ng-if="item.type === TYPES.CLIMATE"
           class="item-entity-container">
         <div>
            <div class="item-button -center-right"
                 ng-if="entity.attributes.temperature && entity.state !== 'off'"
                 ng-click="increaseClimateTemp($event, item, entity)">
               <i class="mdi mdi-plus"></i>
            </div>
            <div class="item-button -bottom-right"
                 ng-if="entity.attributes.temperature && entity.state !== 'off'"
                 ng-click="decreaseClimateTemp($event, item, entity)">
               <i class="mdi mdi-minus"></i>
            </div>
         </div>

         <div class="item-climate">
            <div class="item-climate--target">
               <span ng-bind="climateTarget(item, entity)"></span>
               <span ng-if="(_unit = entityUnit(item, entity))"
                     class="item-climate--target--unit" ng-bind="_unit"></span>
            </div>
            <div class="item-climate--mode" ng-if="entity.attributes.operation_mode"
                 ng-click="openSelect(item)">
               <span ng-bind="entity.attributes.operation_mode"></span>
            </div>
         </div>

         <div ng-if="selectOpened(item)" class="item-select"
              ng-style="itemSelectStyles(entity, entity.attributes.operation_list)">

            <div class="item-select--option"
                 ng-repeat="option in entity.attributes.operation_list track by $index"
                 ng-class="{'-active': option === entity.state}"
                 ng-click="setClimateOption($event, item, entity, option)">
               <span ng-bind="option"></span>
            </div>
         </div>
      </div>


      <div ng-if="item.type === TYPES.MEDIA_PLAYER"
           class="item-entity-container">

         <div class="media-player-table"  ng-class="{'-has-state': _state, '-has-subtitle': _subtitle}">
            <table>
               <tr>
                  <td class="media-player-table--td-main-button">
                     <div class="media-player--main-button" ng-if="entity.state !== 'off'">
                        <span class="mdi mdi-pause" ng-if="supportsFeature(FEATURES.MEDIA_PLAYER.PAUSE, entity) && entity.state === 'playing'"
                              ng-click="sendPlayer('media_pause', item, entity)"></span>

                        <span class="mdi mdi-stop" ng-if="!supportsFeature(FEATURES.MEDIA_PLAYER.PAUSE, entity) && entity.state === 'playing'"
                              ng-click="sendPlayer('media_stop', item, entity)"></span>

                        <span class="mdi mdi-play" ng-if="entity.state === 'stopped'"
                              ng-click="sendPlayer('media_play', item, entity)"></span>

                        <span class="mdi mdi-play" ng-if="entity.state === 'paused'"
                              ng-click="sendPlayer('media_play', item, entity)"></span>

                        <span class="mdi mdi-play" ng-if="entity.state === 'idle'"
                              ng-click="sendPlayer('media_play', item, entity)"></span>

                     </div>
                  </td>
                  <td colspan="2" class="media-player-table--td-buttons">
                     <div class="media-player--buttons">
                        <div class="media-player--button -prev"
                             ng-if="supportsFeature(FEATURES.MEDIA_PLAYER.PREVIOUS_TRACK, entity) && entity.state !== 'off'"
                             ng-click="sendPlayer('media_previous_track', item, entity)">
                           <i class="mdi mdi-skip-previous"></i>
                        </div>

                        <div class="media-player--button -next"
                             ng-if="supportsFeature(FEATURES.MEDIA_PLAYER.NEXT_TRACK, entity) && entity.state !== 'off'"
                             ng-click="sendPlayer('media_next_track', item, entity)">
                           <i class="mdi mdi-skip-next"></i>
                        </div>


</script>
</body>
</html>
